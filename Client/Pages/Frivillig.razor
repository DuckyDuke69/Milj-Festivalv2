@page "/frivillig"
@using MiljøFestivalv2.Shared
@using System.Net.Http.Json
@using Client.Services
@using System.Globalization
@inject HttpClient Http
@inject GlobalState GlobalState
@inject NavigationManager NavManager


<h1>Velkommen, @GlobalState.Brugernavn</h1>


<h1 class="mb-3 mt-3">Alle Vagter</h1>
<table class="table table-striped">
    <thead>
        <tr>

            <th>Område</th>
            <th>Antal Personer</th>
            <th>Beskrivelse</th>
            <th>Start Tid</th>
            <th>Slut tid</th>
            <th>Prioritering</th>
            <th>Book vagt</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var vagt in VagtListe)
        {
            <tr>
                <td>@vagt.område</td>
                <td>@vagt.antal_personer</td>
                <td>@vagt.beskrivelse</td>
                <td>@vagt.start_tid</td>
                <td>@vagt.slut_tid</td>
                <td>@vagt.priotering</td>
               <td> <button @onclick="() => OpretBookingForVagt(vagt)">Book vagt!</button> </td>
            </tr>
        }
    </tbody>  
</table>
<h1 class="mb-3 mt-3">Din Bookinger</h1>

<table class="table table-striped">
    <thead>
        <tr>

            <th>Område</th>
            <th>Beskrivelse</th>
            <th>Start Tid</th>
            <th>Slut tid</th>
            <th>Prioritering</th>
            <th>Vagt id</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var booking in BookingListe)
        {
            <tr>
                <td>@booking.område</td>
                <td>@booking.beskrivelse</td>
                <td>@booking.start_tid</td>
                <td>@booking.slut_tid</td>
                <td>@booking.priotering</td>
                <td>@booking.vagt_id</td>
            </tr>
        }
    </tbody>
</table>
<div>
    <button onclick="@SkiftBrugerInfo">Skift din bruger information</button>
</div>

@code {
    // Laver en liste med datamodel klasserne fra shared
    public List<Vagt> VagtListe = new List<Vagt>();
    public List<Booking> BookingListe = new List<Booking>();

    // Injecter metoderne fra services
    [Inject]
    public IVagtService ServiceVagt { get; set; }
    [Inject]
    public IBookingService ServiceBooking { get; set; }
    // På initialized henter vagter og brugere
    protected override async Task OnInitializedAsync()
    {
        var bruger_id = GlobalState.bruger_id;
        BookingListe = (await ServiceBooking.HentBookingerForBruger(bruger_id)).ToList();
        VagtListe = (await ServiceVagt.HentAlleVagter()).ToList();
    }

    private async Task OpretBooking(Booking booking)
    {
        await ServiceBooking.OpretBooking(booking);
    }

    private async Task OpretBookingForVagt(Vagt vagt)
    {
        Booking booking = new Booking()
        {
            vagt_id = vagt.vagt_id,
            bruger_id = GlobalState.bruger_id,
            er_låst = false // Sætter den til default false når der bookes (skal have en værdi i db)
        };

        await OpretBooking(booking);
    }

    private void SkiftBrugerInfo()
    {
        var bruger_id = GlobalState.bruger_id;
        NavManager.NavigateTo($"/personinfo/{bruger_id}");
    }
}   


