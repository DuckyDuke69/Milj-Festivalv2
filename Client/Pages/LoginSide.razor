@page "/login"
@using MiljøFestivalv2.Shared
@using System.Net.Http.Json
@using Client.Services
@using System.Globalization

@inject NavigationManager NavManager
@inject HttpClient Http

<head>
    <link href="/login.css" rel="stylesheet" />
</head>


<h3>Login</h3>
<div class="centerpage">
    <div class="container">
        <div class="form-container">
            <div>
                <label>Email:  </label>
                <input type="email" @bind="Brugerinfo.Brugernavn" />
            </div>
            <div>
                <label>Password:</label>
                <input type="password" @bind="Brugerinfo.Password" />
            </div>
            <button @onclick="LoginKnap">Login</button>
            <button @onclick="Register">Register</button>
            <h3 style="visibility:@UsynligTilSynlig">Login informationer var forkerte</h3>
        </div>
    </div>
</div>



@code {
    public string UsynligTilSynlig = "hidden";

    Login Brugerinfo = new();

    [Inject]
    public IBrugerService LoginService { get; set; }

    private async Task LoginKnap()
    {
        var loggedInBruger = await LoginService.Login(Brugerinfo);

        if (loggedInBruger != null)
        {
            // Hvis rolle på bruger er "koordinator", redirect til /koordinator 
            if (loggedInBruger.Rolle == "koordinator")
            {
                NavManager.NavigateTo("/koordinator");
            }
            // Hvis rolle på bruger er "frivillig", redirect til /frivillig
            else if (loggedInBruger.Rolle == "frivillig")
            {
                NavManager.NavigateTo("/frivillig");
            }
        }
        else
        {
            UsynligTilSynlig = "visible";
            Console.WriteLine("Login fejlede");
        }
    }

    private void Register()
    {
        NavManager.NavigateTo("/register");
    }

    
}
